# RuleGo 性能优化指南

RuleGo 核心基于无锁设计和有向无环图 (DAG) 路由，本身损耗极低。性能瓶颈通常在于**节点业务逻辑**。

## 1. 性能基准

- **初始化**: 工作量主要在启动时完成。
- **路由**: O(1) 复杂度，节点数量不影响路由性能。
- **并发**: 单机可支撑万级并发（取决于 IO 耗时）。

## 2. 优化建议

1.  **重 I/O 隔离**:
    - `restApiCall`, `dbClient` 等涉及网络的节点，请配置合理的 `poolSize` 和 `readTimeoutMs`。
    - 使用 `node_pool` 将慢速节点放入单独的协程池，避免阻塞主流程。

2.  **减少 JSON 编解码**:
    - 规则链内部尽量传递原始 `[]byte` 或结构体引用。
    - 仅在需要 `jsTransform` 处理字段时才解析为 Map。

3.  **使用内置 Go 函数**:
    - 复杂的数学计算或字符串处理，优先使用 `functions` 节点调用 Go 原生函数，比 `jsTransform`（解释执行）快 10 倍以上。

4.  **AOP 缓存**:
    - 使用 `OnBefore/OnAfter` 切面实现结果缓存。如果某个 API 查询结果短时间内不变，直接在 AOP 层返回缓存。

5.  **批量处理**:
    - 对于 DB 写入，考虑使用 StreamSQL 的窗口函数进行聚合（Tumbling Window），攒批写入，而不是逐条 Insert。

## 3. 性能测试数据 (vCPU 2核 2G)

- **300 并发**：稳定，低延迟。
- **800 并发**：CPU 占用率上升，但吞吐量依然平稳。
- **空闲**：几乎零占用。

---
> **结论**：如果慢，90% 是因为您的 SQL 没建索引，或者 HTTP 接口在等待对方响应。
